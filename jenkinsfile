pipeline {
    agent any

    stages {
        stage('Checkout SCM') {
            steps {
                checkout scm
            }
        }

        stage('Test Branch Fetch and Date') {
            steps {
                script {
                    def branches = sh(script: 'git branch -r --format "%(refname:short)"', returnStdout: true).trim().split("\n")
                    def currentDate = new Date()

                    branches.each { branch ->
                        def lastCommitDateStr = sh(script: "git log -1 --format=%ci origin/${branch}", returnStdout: true).trim()
                        def lastCommitDate = Date.parse("yyyy-MM-dd HH:mm:ss Z", lastCommitDateStr)
                        def diffInDays = (currentDate - lastCommitDate) / (1000 * 60 * 60 * 24)

                        echo "Branch: ${branch} - Last Commit Date: ${lastCommitDateStr} - Days Since Last Commit: ${diffInDays}"
                    }
                }
            }
        }
    }
}
